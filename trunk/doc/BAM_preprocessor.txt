Generating GASV input files from SAM/BAM files
-----------------------------------------------

Usage Information for BAM_preprocessor.pl

The BAM preprocessor generates GASV formatted input files from the SAM/BAM alignment format.

Summary:
(i)   Install SAMTools first. Please see the following webpage to download and 
      install SAMTools.
        http://samtools.sourceforge.net/

      You may want to add the installation directory to your PATH, otherwise you 
      will have to use the -SAMTOOLS_PATH option below.

(ii)  Compute the minimum/maximum fragment sizes (Lmin and Lmax) from BAM files 
      and generate GASV input files from SAM/BAM files.
        Steps:
                0. Compile BAM Preprocessor.
                        Run `./install.sh` from GASV_RELEASE directory
                1. Locate your BAM file to process. (hyperlink of BAM file is 
                        also acceptable)
                2. Decide on BAM_preprocessor.pl options to use (if different 
                        from defaults).
		3. Run the BAM_preprocessor.pl

        Usage:
                % BAM_preprocessor.pl <bam file or hyperlink> [Options]

		**** Options to BAM preprocessor ***
		-SAMTOOLS_PATH     	STRING  The path to samtools executable 
						(not simply the directory).
					   	Required if samtools not in 
						PATH.

		-LIBRARY_SEPARATED 	STRING  Extract fragments from separated 
						libraries or whole BAM file

		-OUTPUT_PREFIX     	STRING  The prefix for output files

		-MAPPING_QUALITY   	INT     Minimum mapping quality

		-CUTOFF_LMINLMAX   	STRING  Lower and upper bound on the 
						fragment distribution

		-USE_NUMBER_READS  	INT     The number of fragments use to
						computing Lmax and Lmin

		-CHROMOSOME_NAMING_FILE STRING  Specify chromosome naming in
						this file

		-PROPER_LENGTH     	INT     Threshold for considering
						fragments as a proper pair

		-PLATFORM		STRING	Specify the platform if the
						SAM/BAM file does not cotain
						'PL' tag in its header

	Options:

		-SAMTOOLS_PATH: (Default Setting: samtools)
			the path to SAMTools' samtools executable (see Step i)

                -LIBRARY_SEPARATED: (Default Setting: separated-library)
                        all			extract all libraries
                        separated-library 	consider each library 
						separately, with a separate set
						of output files for each
						library. 

                        If the BAM file contains multiple libraries, to
			consider each separately use the 'separated-library'
			option.
			
			If no libary info is found, will default to the 'all'
			setting.

                -OUTPUT_PREFIX: (Default Setting: prefix of your BAM file)
			the prefix for output files (can include a relative or 
			absolute path)

                -MAPPING_QUALITY: (Default Setting: 10)
			the threshold for mapping quality. (Only reads
			with mapping quality strictly above this threshold are 
			analyzed.)

                -CUTOFF_LMINLMAX: (Default Setting: PCT=99%)
                	Users can specify a lower and upper bounds on 
			the fragment distribution, Lmin and Lmax, in three
			possible ways:
                        * SD=X: X standard deviation above/below the mean,
				SD=3 means 3 standard deviation above/below
				the mean
                        * PCT=X%: quantile on top/bottom X%, PCT=99% means
				setting quantile at 0.01 and 0.99
                        * EXACT=X,Y: Take Lmin to be X and Lmax to be Y without
				analyzing fragment length distributions at all.

			* FILE=X.txt: specify a file with the following information 
				for using different cutoffs in different libraries

				FORMAT:
				library_id1	EXACT=123,456
				library_id2	SD=3
				library_id3	PCT=90%

                -USE_NUMBER_READS: (Default Setting: 500000)
                	The number of fragments (designated as a proper pair)
			in the BAM file to use in computing Lmax and Lmin.
                        Note that a relatively small number of fragments will
			be sufficient to get a good estimate of Lmin and Lmax.
			Depending on the size of the BAM file and running time
			constraints between 500,000 or 1,000,000 would be
			sufficient for most applications. If EXACT=X,Y is 
			specified for the CUTOFF_LMINLMAX argument, no fragments
			will be used, and USE_NUMBER_READS argument is ignored.

                -CHROMOSOME_NAMING_FILE: 
			This is an optional parameter, you do not need this
			option if you are using the default chromosome naming
			references (a number, X, Y, chr+a number, chrX, and
			chrY).
			
			If you have alternate chromosome names, define the
			alternate names in chromosome naming file as follows: 
			
			Column 1 - Chromosome naming in BAM file, 
			Column 2 - replacing chromosome number

			  Column 1        Column 2 
			  -------------------------
			  Ca21chr1        1
			  Ca21chr2        2
			  Ca21-mtDNA      9

		-PROPER_LENGTH: (Default Setting: 10000)
			Extreme outliers (ESPs with mapped length >10Mb) can
			cause huge standard deviation values which will produce
			large values for Lmax in with the SD option. 
			
			This parameter ignores ESPs with separation above
			PROPER_LENGTH in the computation of Lmin/Lmax SD
			setting.

			Note: If you use EXACT=X,Y or PCT=X% as CUTOFF_LMINLMAX,
			this option will not be considered.

		-PLATFORM:  (SOLiD or Illumina; Default Setting: Illumina)
			BAM preprocessor will automatically detect the platform
			using in SAM/BAM files. If the platform is not specified
			'Illumina' is used as default.			

        Output:
                OUTPUT_PREFIX(_LIBRARY_ID).deletion
                OUTPUT_PREFIX(_LIBRARY_ID).divergent
                OUTPUT_PREFIX(_LIBRARY_ID).inversion
                OUTPUT_PREFIX(_LIBRARY_ID).translocation
                OUTPUT_PREFIX.info

        Notes:
		In the case where no library info is found or 'all' is passed 
		as -LIBRARY_SEPARATED, the word "all" is used as the LIBRARY_ID
		in the output file names.
 
 		The minimum fragment length for deletions is automatically
		assigned as Lmax.

              	Fragments are grouped into output files according to the type of
		structural variant they indicate: deletion, inversion and
		translocation. Divergent fragments indicate a rearrangement that
		is not a deletion, inversion or translocation. Currently, GASV
		does not consider insertions.

        Example:
                perl BAM_Preprocessor.pl NA18507.SLX.maq.SRP000031.2009_08.bam -SAMTOOLS_PATH /prg/samtools-0.1.6/samtools 

		perl BAM_Preprocessor.pl ftp://ftp.ncbi.nlm.nih.gov/1000genomes/ftp/pilot_data/data/NA18507/alignment/NA18507.SLX.maq.SRP000031.2009_08.bam -SAMTOOLS_PATH /prg/samtools-0.1.6/samtools
                
		perl BAM_Preprocessor.pl NA18507.SLX.maq.SRP000031.2009_08.bam -MAPPING_QUALITY 20 -OUTPUT_PREFIX /data/output_dir/NA18507

                perl BAM_Preprocessor.pl NA18507.SLX.maq.SRP000031.2009_08.bam -CUTOFF_LMINLMAX SD=3 -PROPER_LENGTH 2000
                
                perl BAM_Preprocessor.pl NA18507.SLX.maq.SRP000031.2009_08.bam -CHROMOSOME_NAMING_FILE /data/chrom_naming_table.txt
